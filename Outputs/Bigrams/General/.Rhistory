)
# --- Marco estilo panel.border de ggplot (gris claro, delgado) ---
box(col = "grey60", lwd = 1.1) # --- Ejes unificados (negros, grosor homogéneo) ---
axis(1, lwd = 1.1, col = "black", col.ticks = "black", cex.axis = cex_axis)
axis(2, lwd = 1.1, col = "black", col.ticks = "black", cex.axis = cex_axis)
legend(
"topright",
legend = c("Positivo", "Negativo"),
col = c(color_inicial, color_final),
lwd = 2,
lty = 1,
bty = "n",
cex = cex_legend
)
# Create a histogram of positive sentiments
png("hist_score_Correction.png",
width = 12, height = 8, units = "cm", res = 300, pointsize = 8, bg = "white"
)
# --- Parámetros tipográficos unificados ---
cex_axis  <- 1.1   # tamaño números eje
cex_lab   <- 1.2   # tamaño etiquetas eje
cex_legend <- 1.2  # tamaño leyenda
# --- Crear ventana y dibujar grilla debajo ---
plot.new()
plot.window(xlim = c(0.7, 2.9), ylim = c(0, 3))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Histograma positivo ---
hist(
AFIN_completo$media_positivo,
main = "",
xlab = "Puntaje medio de sentimiento",
ylab = "Frecuencia",
prob = TRUE,
col = adjustcolor(color_inicial, alpha.f = 0.50),
ylim = c(0, 3),
xlim = c(0.7, 2.9),
border = NA,
axes = FALSE,
add = TRUE  # ← importante
)
# --- Densidad positiva ---
lines(
density(AFIN_completo$media_positivo),
col = color_inicial,
lwd = 2
)
# --- Histograma negativo ---
hist(
(-1) * AFIN_completo$media_negativo,
prob = TRUE,
col = adjustcolor(color_final, alpha.f = 0.50),
border = NA,
add = TRUE
)
# --- Densidad negativa ---
lines(
density((-1) * AFIN_completo$media_negativo),
col = color_final,
lwd = 2
)
# --- Marco estilo panel.border de ggplot (gris claro, delgado) ---
box(col = "grey60", lwd = 1.1) # --- Ejes unificados (negros, grosor homogéneo) ---
axis(1, lwd = 1.1, col = "black", col.ticks = "black", cex.axis = cex_axis)
axis(2, lwd = 1.1, col = "black", col.ticks = "black", cex.axis = cex_axis)
legend(
"topright",
legend = c("Positivo", "Negativo"),
col = c(color_inicial, color_final),
lwd = 2,
lty = 1,
bty = "n",
cex = cex_legend
)
dev.off()
# Take the negative of MN
MN_negativo <- (-1) * AFIN_completo$media_negativo
MP <- AFIN_completo$media_positivo
#MN_negativo<-append(MN_negativo, 0, after = 1) #run for antioquia
names(MN_negativo) <- NULL
# Create a data frame for ggplot
data <- data.frame(x = 1:length(MP), MP = MP, MN = MN_negativo)
#### GOODNESS OF FIT TESTS FOR THE MEAN
shapiro_test <- shapiro.test(MP - MN_negativo)
# Mann-Whitney-Wilcoxon test
wilcoxon_test <- wilcox.test(MN_negativo, MP, alternative = "greater", paired = T)
# Student's t-test (for equality of means)
t_test <- t.test(MN_negativo, MP, alternative = "greater", var.equal = TRUE, paired = T)
# Calculate means and medians
media_MP <- mean(MP)
media_MN <- mean(MN_negativo)
mediana_MP <- median(MP)
mediana_MN <- median(MN_negativo)
## GRAPHIC PROPORTION 1
PP <- AFIN_completo$frecuencia_positivo / (AFIN_completo$frecuencia_positivo + AFIN_completo$frecuencia_negativo)
PN <- AFIN_completo$frecuencia_negativo / (AFIN_completo$frecuencia_positivo + AFIN_completo$frecuencia_negativo)
# Create kernel densities for PP and PN
densidad_PP <- density(PP)
densidad_PN <- density(PN)
plot.new()
plot.window(xlim = c(0, 1), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
plot(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
# --- Cuadrícula ligera (gris, líneas rectas) ---
grid(col = "grey85", lwd = 0.8, lty = 1)
plot.new()
plot.window(xlim = c(0, 1), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
lines(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
# --- Marco similar a ggplot (gris suave) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
plot.new()
plot.window(xlim = c(-.5, 1), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
lines(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
plot.window(xlim = c(-.05, 1), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
plot.new()
plot.window(xlim = c(-.05, 1), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
lines(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
plot.new()
plot.window(xlim = c(-.05, 0.9), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
lines(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
plot.new()
plot.window(xlim = c(-.05, 0.85), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
lines(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
# --- Marco similar a ggplot (gris suave) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
axis(2, lwd = 1.2, col = "black", col.ticks = "black")
# --- Líneas verticales de medias ---
abline(v = mean(PP), col = color_inicial, lwd = 2, lty = 2)
abline(v = mean(PN), col = color_final,   lwd = 2, lty = 2)
# --- Leyenda en español ---
legend(
"topleft",
legend = c("Positivo", "Negativo"),
col = c(color_inicial, color_final),
lwd = 2,
lty = 2,
bty = "n",
cex = 1.1
)
# Plot the Kernel density of PP in blue
png("dens_proportion_Correction.png",
width = 12, height = 8, units = "cm", res = 300, pointsize = 8, bg = "white"
)
plot.new()
plot.window(xlim = c(-.05, 0.85), ylim = c(0, 7))
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Gráfico base sin ejes para reconstruirlos ---
lines(
densidad_PN,
main = "",
xlab = "Proporción",
ylab = "Densidad",
col = adjustcolor(color_final, alpha.f = 0.5),
lwd = 2,
axes = FALSE
)
# --- Marco similar a ggplot (gris suave) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
axis(2, lwd = 1.2, col = "black", col.ticks = "black")
# --- Líneas verticales de medias ---
abline(v = mean(PP), col = color_inicial, lwd = 2, lty = 2)
abline(v = mean(PN), col = color_final,   lwd = 2, lty = 2)
# --- Leyenda en español ---
legend(
"topleft",
legend = c("Positivo", "Negativo"),
col = c(color_inicial, color_final),
lwd = 2,
lty = 2,
bty = "n",
cex = 1.1
)
dev.off()
# Load necessary libraries
library(udpipe)
library(stringr)
library(tibble)
library(readr)
library(ggplot2)
library(wordcloud)
library(dplyr)
library(tidyr)
library(tidyverse)
library(tidytext)
library(magrittr)
library(igraph)
library(ngram)
library(xtable)
library(EnvStats)
library(RColorBrewer)
# Set working directory
setwd("C:/Users/Pc/Desktop/-Proyecto-JEP-/Outputs/Skipgrams/General")
# Read the subtitles data
subtitulos_JEP_03 <- read_csv("C:/Users/Pc/Desktop/-Proyecto-JEP-/Scraping/subtitulos_JEP_03.csv")
# Read stop words and filter words
stop_words_es <- read.table("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data/stop_words_spanish.txt", quote = "\"", comment.char = "")
FilPal <- read_csv("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data/FilPal.txt", col_names = FALSE)
# Read and process corrections
correcciones <- readLines("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data/Grupos de Palabras/palabras_correcciones.txt")
correcciones_df <- as.data.frame(do.call(rbind, strsplit(correcciones, " - ")), stringsAsFactors = FALSE)
names(correcciones_df) <- c("Palabra_Original", "Correccion")
correcciones_df <- correcciones_df %>%
mutate(Correccion = str_replace(Correccion, "^NA$", "")) %>%
filter(Correccion == "")
# Combine stop words
stop_words_es <- c(stop_words_es$V1, FilPal$X1, correcciones_df$Palabra_Original)
stop_words_es <- tibble(word = unlist(stop_words_es), lexicon = "custom")
# Preprocess subtitles: remove music tags, NA values, convert to lowercase, remove non-alphabetic characters, and trim whitespace
subtitulos_JEP_03 <- subtitulos_JEP_03 %>%
mutate(Subtitulos = str_replace_all(Subtitulos, "\\[Música\\]", "")) %>%
filter(!is.na(Subtitulos)) %>%
as.data.frame()
subtitulos_JEP_03 <- within(subtitulos_JEP_03, {
Subtitulos <- str_to_lower(Subtitulos)
Subtitulos <- str_replace_all(Subtitulos, "[^a-záéíóúüñ ]", "")
Subtitulos <- str_squish(Subtitulos)
})
# Combine subtitles into a single string
subtitulos <- paste(subtitulos_JEP_03$Subtitulos, collapse = ' ')
subtitulos <- tibble(text = subtitulos)
# Tokenize and remove stop words
subtitulos <- subtitulos %>%
unnest_tokens(input = text, output = word, token = "regex", pattern = "\\s+") %>%
anti_join(x = ., y = stop_words_es)
# Extract tokens
tokens <- subtitulos$word
# Create skipgrams (bigrams with a skip of one word)
skipgrams <- sapply(1:(length(tokens) - 2), function(i) {
words <- sort(c(tokens[i], tokens[i + 2]))
paste(words, collapse = " ")
})
# Convert skipgrams to dataframe
skipgrams <- as.vector(skipgrams)
skipgrams <- str_split_fixed(skipgrams, " ", 2)
word_1 <- skipgrams[, 1]
word_2 <- skipgrams[, 2]
skipgrams2 <- cbind(word_1, word_2)
skipgrams2 <- as.data.frame(skipgrams2)
# Filter skipgrams and count occurrences
skipgrams2 <- skipgrams2 %>%
filter(!word_1 %in% stop_words_es$word & !word_2 %in% stop_words_es$word) %>%
filter(word_1 != word_2) %>%
count(word_1, word_2, sort = TRUE) %>%
rename(weight = n)
# Calculate skewness for different thresholds
threshold <- unique(skipgrams2$weight)
count <- skipgrams2$weight
s <- NULL
for (i in 1:length(threshold)) {
s[i] <- skewness(skipgrams2[count > threshold[i], ]$weight)
}
color_inicial <- "#008080"
color_final <- "#011f4b"
png("skewness_Correction_skipa.png",
width = 12, height = 8, units = "cm", res = 300, pointsize = 8, bg = "white"
)
cex_axis  <- 1.1   # tamaño números eje
cex_lab   <- 1.2   # tamaño etiquetas eje
cex_legend <- 1.2  # tamaño leyenda
plot(
threshold, s,
xlim = c(0, 100),
ylim = range(s, na.rm = TRUE),
type = "b",
pch = 19,
col = color_inicial,
xlab = "Umbral",
ylab = "Asimetría (Skewness)",
main = "",
cex.lab = cex_lab,
cex.axis = cex_axis,
axes = FALSE
)
# --- Cuadrícula recta estilo theme_light ---
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Marco gris suave (imitando panel.border de ggplot) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros y limpios ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
axis(2, lwd = 1.2, col = "black", col.ticks = "black")
# --- Línea vertical marcada ---
abline(v = 40, col = color_final, lwd = 2, lty = 2)
dev.off()
png("skewness_Correction_skipa.png",
width = 12, height = 8, units = "cm", res = 300, pointsize = 8, bg = "white"
)
cex_axis  <- 1.1   # tamaño números eje
cex_lab   <- 1.2   # tamaño etiquetas eje
cex_legend <- 1.2  # tamaño leyenda
plot(
threshold, s,
xlim = c(0, 100),
ylim = range(s, na.rm = TRUE),
type = "b",
pch = 19,
col = color_inicial,
xlab = "Umbral",
ylab = "Asimetría (Skewness)",
main = "",
cex.lab = cex_lab,
cex.axis = cex_axis,
axes = FALSE
)
# --- Cuadrícula recta estilo theme_light ---
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Marco gris suave (imitando panel.border de ggplot) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros y limpios ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
axis(2, lwd = 1.2, col = "black", col.ticks = "black")
# --- Línea vertical marcada ---
abline(v = 40, col = color_final, lwd = 2, lty = 2)
dev.off()
plot(
threshold, s,
xlim = c(0, 100),
ylim = range(s, na.rm = TRUE),
type = "b",
pch = 19,
col = color_inicial,
xlab = "Umbral",
ylab = "Asimetría (Skewness)",
main = "",
cex.lab = cex_lab,
cex.axis = cex_axis,
axes = FALSE
)
# --- Cuadrícula recta estilo theme_light ---
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Marco gris suave (imitando panel.border de ggplot) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros y limpios ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
axis(2, lwd = 1.2, col = "black", col.ticks = "black")
library(udpipe)
library(stringr)
library(tibble)
library(readr)
library(ggplot2)
library(wordcloud)
library(dplyr)
library(tidyr)
library(tidyverse)
library(tidytext)
library(magrittr)
library(igraph)
library(ngram)
library(xtable)
library(EnvStats)
library(RColorBrewer)
# Set working directory to data directory
setwd("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data")
# Read subtitles and stop words
subtitulos_JEP_03 <- read_csv("C:/Users/Pc/Desktop/-Proyecto-JEP-/Scraping/subtitulos_JEP_03.csv")
stop_words_es <- read.table("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data/stop_words_spanish.txt", quote = "\"", comment.char = "")
FilPal <- read_csv("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data/FilPal.txt", col_names = FALSE)
# Read and process corrections
correcciones <- readLines("C:/Users/Pc/Desktop/-Proyecto-JEP-/Data/Grupos de Palabras/palabras_correcciones.txt")
correcciones_df <- as.data.frame(do.call(rbind, strsplit(correcciones, " - ")), stringsAsFactors = FALSE)
names(correcciones_df) <- c("Palabra_Original", "Correccion")
correcciones_df <- correcciones_df %>%
mutate(Correccion = str_replace(Correccion, "^NA$", "")) %>%
filter(Correccion == "")
# Combine stop words
stop_words_es <- c(stop_words_es$V1, FilPal$X1, correcciones_df$Palabra_Original)
stop_words_es <- tibble(word = unlist(stop_words_es), lexicon = "custom")
# Preprocess subtitles: remove music tags and NA values
subtitulos_JEP_03 <- subtitulos_JEP_03 %>%
mutate(Subtitulos = str_replace_all(Subtitulos, "\\[Música\\]", "")) %>%
filter(!is.na(Subtitulos)) %>%
as.data.frame()
# Set working directory for bigram outputs
setwd("C:/Users/Pc/Desktop/-Proyecto-JEP-/Outputs/Bigrams/General/")
# Preprocess subtitles: convert to lowercase, remove non-alphabetic characters, and trim whitespace
subtitulos_JEP_03 <- within(subtitulos_JEP_03, {
Subtitulos <- str_to_lower(Subtitulos)
Subtitulos <- str_replace_all(Subtitulos, "[^a-záéíóúüñ ]", "")
Subtitulos <- str_squish(Subtitulos)
})
# Combine subtitles into a single string
subtitulos <- paste(subtitulos_JEP_03$Subtitulos, collapse = ' ')
subtitulos <- tibble(text = subtitulos)
# Tokenize and remove stop words
subtitulos <- subtitulos %>%
unnest_tokens(input = text, output = word, token = "regex", pattern = "\\s+") %>%
anti_join(x = ., y = stop_words_es)
# Extract tokens
tokens <- subtitulos$word
# Create bigrams
bigrams <- sapply(1:(length(tokens) - 1), function(i) {
words <- sort(c(tokens[i], tokens[i + 1]))
paste(words, collapse = " ")
})
# Convert bigrams to dataframe
bigrams <- as.vector(bigrams)
bigrams <- str_split_fixed(bigrams, " ", 2)
word_1 <- bigrams[, 1]
word_2 <- bigrams[, 2]
bigrams2 <- cbind(word_1, word_2)
bigrams2 <- as.data.frame(bigrams2)
# Filter bigrams and count occurrences
bigrams2 <- bigrams2 %>%
filter(!word_1 %in% stop_words_es$word & !word_2 %in% stop_words_es$word) %>%
filter(word_1 != word_2) %>%
count(word_1, word_2, sort = TRUE) %>%
rename(weight = n)
# Calculate skewness for different thresholds
threshold <- unique(bigrams2$weight)
count <- bigrams2$weight
s <- NULL
for (i in 1:length(threshold)) {
s[i] <- skewness(bigrams2[count > threshold[i], ]$weight)
}
color_inicial <- "#008080"
color_final <- "#011f4b"
# Plot skewness vs threshold
png("skewness_Correction.png",
width = 12, height = 8, units = "cm", res = 300, pointsize = 8, bg = "white"
)
# --- Gráfico base sin ejes para reconstruirlos ---
cex_axis  <- 1.1   # tamaño números eje
cex_lab   <- 1.2   # tamaño etiquetas eje
cex_legend <- 1.2  # tamaño leyenda
plot(
threshold, s,
xlim = c(0, 100),
ylim = range(s, na.rm = TRUE),
type = "b",
pch = 19,
col = color_inicial,
xlab = "Umbral",
ylab = "Asimetría (Skewness)",
main = "",
cex.lab = cex_lab,
cex.axis = cex_axis,
axes = FALSE
)
# --- Cuadrícula recta estilo theme_light ---
grid(col = "grey85", lwd = 0.8, lty = 1)
# --- Marco gris suave (imitando panel.border de ggplot) ---
box(col = "grey70", lwd = 1.2)
# --- Ejes negros y limpios ---
axis(1, lwd = 1.2, col = "black", col.ticks = "black")
axis(2, lwd = 1.2, col = "black", col.ticks = "black")
# --- Línea vertical marcada ---
abline(v = 40, col = color_final, lwd = 2, lty = 2)
dev.off()
